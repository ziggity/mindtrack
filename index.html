<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindTrack - Your Personal Wellness Journal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
       /* --- General Styling & Setup --- */
       :root {
            /* Light Mode Colors (default state) */
            --primary-color: #3B82F6;
            --primary-light: #EFF6FF;
            --secondary-color: #10B981;
            --bg-color: #F9FAFB;
            --card-bg: #FFFFFF;
            --text-color: #1F2937;
            --text-muted: #6B7280;
            --border-color: #E5E7EB;
            --input-bg: #F9FAFB;
        }

        body.dark-mode {
            /* Dark Mode Colors */
            --primary-color: #60A5FA;
            --primary-light: #374151;
            --secondary-color: #34D399;
            --bg-color: #111827;
            --card-bg: #1F2937;
            --text-color: #F9FAFB;
            --text-muted: #9CA3AF;
            --border-color: #4B5563;
            --input-bg: #374151;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Layout & Structure --- */
        .container { max-width: 960px; margin: 0 auto; padding: 20px; }
        header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 { color: var(--primary-color); font-size: 2.5rem; }
        nav { position: sticky; top: 0; background: var(--card-bg); z-index: 1000; border-bottom: 1px solid var(--border-color); }
        nav ul { list-style: none; display: flex; justify-content: center; flex-wrap: wrap; padding: 1rem 0; }
        nav ul li a { text-decoration: none; color: var(--text-muted); padding: 0.5rem 1.5rem; font-weight: 600; transition: color 0.3s, background-color 0.3s; border-radius: 20px; }
        nav ul li a:hover, nav ul li a.active { color: var(--primary-color); background-color: var(--primary-light); }
        section { background: var(--card-bg); margin-bottom: 2rem; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 1px solid var(--border-color); }
        h2 { font-size: 1.8rem; color: var(--text-color); margin-bottom: 1.5rem; border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; }
        h3 { font-size: 1.2rem; color: var(--text-color); margin-top: 1.5rem; margin-bottom: 1rem; }
        button { background-color: var(--primary-color); color: #FFFFFF; border: none; padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: 600; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; display: block; width: 100%; }
        button:hover { opacity: 0.9; }
        textarea { width: 100%; padding: 1rem; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1rem; font-family: inherit; resize: vertical; background-color: var(--input-bg); color: var(--text-color); }

        /* --- Theme Toggle Switch --- */
        .theme-switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* --- NEW: Inspiration Board --- */
        .inspiration-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .inspiration-box {
            position: relative;
            aspect-ratio: 1 / 1;
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            background-color: var(--input-bg);
            transition: border-color 0.3s, background-color 0.3s;
        }
        .inspiration-box .add-content-btn {
            font-size: 3rem;
            font-weight: 200;
            color: var(--text-muted);
            background: none;
            border: none;
            width: 100%;
            height: 100%;
        }
        .inspiration-box img { width: 100%; height: 100%; object-fit: cover; }
        .inspiration-box .quote-content { padding: 1rem; text-align: center; font-style: italic; font-size: 0.9rem; }
        .inspiration-box .remove-content-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: rgba(0,0,0,0.6);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            line-height: 24px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .inspiration-box:hover .remove-content-btn { opacity: 1; }

        /* --- Other Sections --- */
        #quote-section { text-align: center; background: var(--primary-light); border: 1px solid var(--border-color); padding: 1.5rem; }
        #quote-text { font-size: 1.1rem; font-style: italic; color: var(--text-color); margin-bottom: 1rem; }
        #quote-author { font-weight: 600; color: var(--primary-color); margin-bottom: 1.5rem; }
        #new-quote-btn { width: auto; margin: 0 auto; padding: 0.5rem 1.25rem; font-size: 0.9rem; background-color: var(--secondary-color); }
        
        .mood-selector {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        .mood-option {
            cursor: pointer;
            padding: 0.75rem;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
            font-size: 2rem;
            line-height: 1;
        }
        .mood-option.selected { 
            border-color: var(--primary-color); 
            background-color: var(--primary-light);
        }
        /* --- Calendar Section --- */
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

#month-year {
    font-size: 1.5rem;
    font-weight: 600;
}

.calendar-nav {
    background: var(--primary-color);
    color: #FFFFFF;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    cursor: pointer;
}

/* This is the main container for the calendar grid */
.calendar-grid {
    display: grid;
    /* This is the magic line that creates 7 columns */
    grid-template-columns: repeat(7, 1fr);
    gap: 5px; /* Adjusts spacing between days */
}

/* General styling for all cells in the grid */
.calendar-grid div {
    text-align: center;
    padding: 0.75rem 0.25rem;
    border-radius: 4px;
}

/* Styling for the "Sun, Mon, Tue..." labels */
.weekday {
    font-weight: 600;
    color: var(--text-muted);
}

/* Styling for the individual day numbers */
.day {
    cursor: pointer;
    transition: background-color 0.2s;
}

.day:hover {
    background-color: var(--primary-light);
}
        .health-log label { display: flex; align-items: center; background: var(--input-bg); padding: 0.75rem; border-radius: 6px; cursor: pointer; }
        #entry-date-display { font-weight: 600; color: var(--text-muted); text-align: center; margin-bottom: 1.5rem; font-size: 1.2rem; }
        .journal-post-date { font-weight: 600; color: var(--text-muted); }

        .calendar-grid .day {
            position: relative;
        }
        .calendar-grid .day .mood-emoji {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 0.8rem;
        }

    </style>
</head>
<body>
    <style>
        #google_translate_element {
          position: absolute;
          top: 100px;
          left: 10px; /* Shifted from right to left */
          z-index: 9999;
          background: #fff;
          padding: 6px 12px;
          border-radius: 6px;
          box-shadow: 0 0 8px rgba(0,0,0,0.1);
          font-size: 14px;
        }
        .goog-te-gadget img {
          display: none;
        }
      </style>
  </head>
 
  
  <div id="google_translate_element"></div>
  
  <h1>MindTrack</h1>
  <label class="theme-switch" for="theme-toggle" title="Toggle Dark Mode">
      <input type="checkbox" id="theme-toggle">Darkmode
      <span class="slider"></span>
  </label>
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en',
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
        includedLanguages: 'en,es,fr,de,zh,ja,zh-CN'
      }, 'google_translate_element');
    }
  </script>
  
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <nav>
        <ul>
            <li><a href="#dashboard" class="active">Dashboard</a></li>
            <li><a href="#journal">Journal</a></li>
            <li><a href="#calendar">Calendar</a></li>
            <li><a href="#trends">Trends</a></li>
            <li><a href="#guides">Guides</a></li>
        </ul>
    </nav>
    
    <main class="container">
        <section id="inspiration-board">
            <h2>Inspiration Board</h2>
            <div class="inspiration-grid" id="inspiration-grid">
            </div>
            <input type="file" id="image-uploader" accept="image/*" style="display: none;">
        </section>
        <section id="quote-section">
            <p id="quote-text">Loading quote...</p>
            <p id="quote-author"></p>
            <button id="new-quote-btn">New Quote</button>
        </section>

        <section id="dashboard">
            <h2>Today's Check-in</h2>
            <p id="entry-date-display"></p>
            <h3>How are you feeling today?</h3>
            <div class="mood-selector">
                <span class="mood-option" data-mood="terrible" title="Terrible">ðŸ˜«</span>
                <span class="mood-option" data-mood="awful" title="Awful">ðŸ˜ž</span>
                <span class="mood-option" data-mood="sad" title="Sad">ðŸ˜”</span>
                <span class="mood-option" data-mood="anxious" title="Anxious">ðŸ˜¬</span>
                <span class="mood-option" data-mood="okay" title="Okay">ðŸ™‚</span>
                <span class="mood-option" data-mood="good" title="Good">ðŸ˜Š</span>
                <span class="mood-option" data-mood="great" title="Great">ðŸ˜„</span>
                <span class="mood-option" data-mood="joyful" title="Joyful">ðŸ¥°</span>
            </div>
            <h3>Health Log</h3>
            <div class="health-log">
                <label><input type="checkbox" id="sleep"> Good Sleep (7+ hrs)</label>
                <label><input type="checkbox" id="exercise"> Exercise</label>
                <label><input type="checkbox" id="meditate"> Meditated</label>
                <label><input type="checkbox" id="socialize"> Socialized</label>
                <label><input type="checkbox" id="medication"> Took Medication</label>
                <label><input type="checkbox" id="hydrate"> Hydrated Well</label>
            </div>
            <h3>Quick Notes</h3>
            <textarea id="notes" placeholder="Any brief notes for today? (Triggers, accomplishments, etc.)"></textarea>
            <button id="save-entry">Save Daily Check-in</button>
        </section>
        
        <section id="journal">
            <h2>Journal</h2>
            <h3>New Entry</h3>
            <textarea id="journal-entry" placeholder="Write about your day, your thoughts, and your feelings..."></textarea>
            <button id="save-journal-entry">Save Journal Entry</button>
            <div class="journal-log-container">
                <h3>Past Entries</h3>
                <div id="journal-log"></div>
            </div>
        </section>

        <section id="calendar">
            <h2>Your Progress Calendar</h2>
            <div class="calendar-header">
                <button class="calendar-nav" id="prev-month">&lt; Prev</button>
                <span id="month-year"></span>
                <button class="calendar-nav" id="next-month">Next &gt;</button>
            </div>
            <div class="calendar-grid weekdays">
                <div class="weekday">Sun</div> <div class="weekday">Mon</div> <div class="weekday">Tue</div> <div class="weekday">Wed</div> <div class="weekday">Thu</div> <div class="weekday">Fri</div> <div class="weekday">Sat</div>
            </div>
            <div class="calendar-grid" id="calendar-days"></div>
        </section>

        <section id="trends">
            <h2>Trends & Analytics</h2>
            <h3>Mood Over Time</h3>
            <div class="chart-container"><canvas id="moodChart"></canvas></div>
            <h3>Health Habit Frequency</h3>
            <div class="chart-container"><canvas id="healthHabitChart"></canvas></div>
        </section>

        <section id="guides">
            <h2>Guides & Resources</h2>
            <div class="accordion">
                <div class="accordion-item">
                    <button class="accordion-header">Cognitive Behavioral Therapy (CBT) Guides</button>
                    <div class="accordion-content"><h4>What is CBT?</h4><p>CBT helps you identify and challenge negative thought patterns. The goal is to replace them with more objective, realistic thoughts.</p></div>
                </div>
                <div class="accordion-item">
                    <button class="accordion-header">Mindful Meditation Guides</button>
                    <div class="accordion-content">
                        <h4>Mindful Breathing (3-Minute Exercise)</h4>
                        <p>Find a quiet, comfortable place to sit. Close your eyes and focus your attention on your breath. Notice the cool air entering your nose and the warm air leaving it. Follow the sensation of your breath as it fills your lungs and then as it is released. If your mind starts to wander, that's okay. Simply acknowledge the thought and gently return your focus to your breath. Do this for three minutes.</p>
                    </div>
                </div>
                <section id="cbt-session">
                    <h2>Mini CBT Session</h2>
                    <p>A simple exercise to help you challenge negative thoughts and feelings.</p>
                    
                    <h3>1. The Situation/Trigger</h3>
                    <textarea id="cbt-situation" placeholder="What happened or what were you thinking?"></textarea>
                
                    <h3>2. The Automatic Thought</h3>
                    <textarea id="cbt-thought" placeholder="What was the first negative thought that came to mind?"></textarea>
                
                    <h3>3. Challenge the Thought</h3>
                    <textarea id="cbt-challenge" placeholder="What's the evidence for this thought? Is there another way of looking at this?"></textarea>
                
                    <h3>4. Find a New Behavior</h3>
                    <textarea id="cbt-behavior" placeholder="Based on your new perspective, what is one positive action you can take?"></textarea>
                
                    <button id="save-cbt-entry">Save CBT Entry</button>
                
                    <div class="journal-log-container">
                        <h3>Past CBT Entries</h3>
                        <div id="cbt-log"></div>
                    </div>
                </section>
                <div class="accordion-item">
                    <button class="accordion-header">Stress Release Activities</button>
                    <div class="accordion-content">
                        <h4>Mindful Distractions & Movement</h4>
                        <ul>
                            <li><strong>Go for a walk.</strong> Just 10-15 minutes of walking can significantly lower stress hormones.</li>
                            <li><strong>Stretch your body.</strong> Simple stretches can release physical tension.</li>
                            <li><strong>Listen to music.</strong> Put on a song that makes you feel good and really listen to the lyrics and rhythm.</li>
                            <li><strong>Write it out.</strong> Use the journal to write about your feelings without judgment.</li>
                            <li><strong>Do a creative task.</strong> Try sketching, doodling, or playing an instrument.</li>
                        </ul>
                    </div>
                    
                </div>
       
        </div>
        <div class="accordion-item">
            <button class="accordion-header">Mindfulness Guides</button>
            <div class="accordion-content"><h4>Mindful Breathing (1-Minute Exercise)</h4><p>This is a simple technique to ground yourself. Sit comfortably, close your eyes, and focus on the sensation of your breath without trying to change it. If your mind wanders, gently guide it back.</p></div>
        </div><h4>Meditation Timer (3 Minutes)</h4>
        <div style="text-align: center; margin-top: 1rem;">
            <div id="timer-visual-container" style="position: relative; width: 150px; height: 150px; margin: 0 auto;">
                <svg id="timer-progress-svg" viewBox="0 0 100 100" style="width: 100%; height: 100%;">
                    <circle cx="50" cy="50" r="45" fill="none" stroke="var(--border-color)" stroke-width="5"/>
                    <circle id="timer-progress-bar" cx="50" cy="50" r="45" fill="none" stroke="var(--primary-color)" stroke-width="5" stroke-dasharray="282.7" stroke-dashoffset="282.7" transform="rotate(-90 50 50)"/>
                </svg>
                <div id="timer-display" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; font-weight: bold; color: var(--text-color);">03:00</div>
            </div>
            <div style="margin-top: 1rem;">
                <button id="start-timer-btn" style="width: auto; margin-right: 0.5rem; background-color: var(--secondary-color);">Start</button>
                <button id="reset-timer-btn" style="width: auto; background-color: var(--text-muted);">Reset</button>
            </div>
                
            </div>
        </section>
        
        </div>
    </main>

    <footer>
        <p>&copy; 2025 MindTrack. For personal tracking only.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- STATE MANAGEMENT ---
            let dailyData = JSON.parse(localStorage.getItem('mindTrackDailyData')) || {};
            let journalData = JSON.parse(localStorage.getItem('mindTrackJournalData')) || {};
            let inspirationData = JSON.parse(localStorage.getItem('mindTrackInspirationData')) || new Array(5).fill(null);
            let currentInspirationIndex = -1;
            let currentDate = new Date();
            let selectedDate = new Date();
            let moodChartInstance = null;
            let healthHabitChartInstance = null;
            
            // Map mood data text to their corresponding emojis and chart values
            const moodEmojiMap = {
                'terrible': 'ðŸ˜«',
                'awful': 'ðŸ˜ž',
                'sad': 'ðŸ˜”',
                'anxious': 'ðŸ˜¬',
                'okay': 'ðŸ™‚',
                'good': 'ðŸ˜Š',
                'great': 'ðŸ˜„',
                'joyful': 'ðŸ¥°'
            };

            const moodChartMap = {
                'terrible': 1,
                'awful': 2,
                'sad': 3,
                'anxious': 4,
                'okay': 5,
                'good': 6,
                'great': 7,
                'joyful': 8
            };
            
            // --- DOM ELEMENTS ---
            const themeToggle = document.getElementById('theme-toggle');
            const inspirationGrid = document.getElementById('inspiration-grid');
            const imageUploader = document.getElementById('image-uploader');
            const moodOptions = document.querySelectorAll('.mood-option');
            const healthCheckboxes = document.querySelectorAll('.health-log input[type="checkbox"]');
            const notesInput = document.getElementById('notes');
            const saveButton = document.getElementById('save-entry');
            const calendarDaysContainer = document.getElementById('calendar-days');
            const monthYearDisplay = document.getElementById('month-year');
            const prevMonthButton = document.getElementById('prev-month');
            const nextMonthButton = document.getElementById('next-month');
            const entryDateDisplay = document.getElementById('entry-date-display');
            const journalEntryInput = document.getElementById('journal-entry');
            const saveJournalButton = document.getElementById('save-journal-entry');
            const journalLogContainer = document.getElementById('journal-log');
            const quoteTextEl = document.getElementById('quote-text');
            const quoteAuthorEl = document.getElementById('quote-author');
            const newQuoteBtn = document.getElementById('new-quote-btn');
            const toISODateString = (date) => date.toISOString().split('T')[0];
            const formatDisplayDate = (date) => date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

// --- MEDITATION TIMER FUNCTIONALITY ---
let meditationTimer;
let timeLeft = 180; // 3 minutes in seconds
const timerDisplay = document.getElementById('timer-display');
const startBtn = document.getElementById('start-timer-btn');
const resetBtn = document.getElementById('reset-timer-btn');

const updateTimerDisplay = () => {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
};

const startTimer = () => {
    startBtn.disabled = true;
    startBtn.textContent = 'Pause';
    meditationTimer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        if (timeLeft <= 0) {
            clearInterval(meditationTimer);
            alert('Meditation complete!');
            startBtn.textContent = 'Done!';
        }
    }, 1000);
};

const pauseTimer = () => {
    clearInterval(meditationTimer);
    startBtn.disabled = false;
    startBtn.textContent = 'Continue';
};

const resetTimer = () => {
    clearInterval(meditationTimer);
    timeLeft = 180;
    updateTimerDisplay();
    startBtn.disabled = false;
    startBtn.textContent = 'Start';
};

startBtn.addEventListener('click', () => {
    if (meditationTimer) {
        pauseTimer();
    } else {
        startTimer();
    }
});

resetBtn.addEventListener('click', resetTimer);

// Initial display on page load
updateTimerDisplay();
            // --- INSPIRATION BOARD FUNCTIONALITY ---
            const renderInspirationBoard = () => {
                inspirationGrid.innerHTML = '';
                inspirationData.forEach((item, index) => {
                    const box = document.createElement('div');
                    box.className = 'inspiration-box';
                    box.dataset.index = index;

                    if (item) {
                        if (item.type === 'image') {
                            box.innerHTML = `<img src="${item.content}" alt="User inspiration image">`;
                        } else if (item.type === 'quote') {
                            box.innerHTML = `<div class="quote-content"><p>"${item.content}"</p></div>`;
                        }
                        box.innerHTML += `<button class="remove-content-btn" title="Remove">&times;</button>`;
                    } else {
                        box.innerHTML = `<button class="add-content-btn" title="Add Image or Quote">+</button>`;
                    }
                    inspirationGrid.appendChild(box);
                });
            };

        // --- CBT FUNCTIONALITY ---
        const cbtData = JSON.parse(localStorage.getItem('mindTrackCBTData')) || {};

const saveCbtData = () => {
    const timestamp = new Date().toISOString();
    cbtData[timestamp] = {
        situation: document.getElementById('cbt-situation').value.trim(),
        thought: document.getElementById('cbt-thought').value.trim(),
        challenge: document.getElementById('cbt-challenge').value.trim(),
        behavior: document.getElementById('cbt-behavior').value.trim()
    };
    localStorage.setItem('mindTrackCBTData', JSON.stringify(cbtData));
    
    // Clear the form
    document.getElementById('cbt-situation').value = '';
    document.getElementById('cbt-thought').value = '';
    document.getElementById('cbt-challenge').value = '';
    document.getElementById('cbt-behavior').value = '';
    
    alert('CBT entry saved!');
    renderCbtLog();
};

const renderCbtLog = () => {
    const cbtLogContainer = document.getElementById('cbt-log');
    cbtLogContainer.innerHTML = '';
    const sortedEntries = Object.keys(cbtData).sort().reverse();
    if (sortedEntries.length === 0) {
        cbtLogContainer.innerHTML = '<p>No CBT entries yet.</p>';
        return;
    }
    sortedEntries.forEach(timestamp => {
        const entryDate = new Date(timestamp);
        const entry = cbtData[timestamp];
        const entryDiv = document.createElement('div');
        entryDiv.className = 'journal-post';
        entryDiv.innerHTML = `
            <p class="journal-post-date">${formatDisplayDate(entryDate)}</p>
            <p><strong>Situation:</strong> ${entry.situation}</p>
            <p><strong>Thought:</strong> ${entry.thought}</p>
            <p><strong>Challenge:</strong> ${entry.challenge}</p>
            <p><strong>New Behavior:</strong> ${entry.behavior}</p>
        `;
        cbtLogContainer.appendChild(entryDiv);
    });
};

document.getElementById('save-cbt-entry').addEventListener('click', saveCbtData);

// You'll need to add renderCbtLog() to your DOMContentLoaded listener to load past entries on startup.
// e.g., Inside your DOMContentLoaded block:
// renderCbtLog();
            inspirationGrid.addEventListener('click', (e) => {
                const box = e.target.closest('.inspiration-box');
                if (!box) return;
                
                currentInspirationIndex = parseInt(box.dataset.index);

                if (e.target.classList.contains('add-content-btn')) {
                    const choice = prompt("What would you like to add? Type 'image' or 'quote'.");
                    if (choice && choice.toLowerCase() === 'image') {
                        imageUploader.click(); // Trigger hidden file input
                    } else if (choice && choice.toLowerCase() === 'quote') {
                        const quoteText = prompt("Enter your inspirational quote:");
                        if (quoteText) {
                            inspirationData[currentInspirationIndex] = { type: 'quote', content: quoteText };
                            saveAndRenderInspiration();
                        }
                    }
                } else if (e.target.classList.contains('remove-content-btn')) {
                    if (confirm("Are you sure you want to remove this item?")) {
                        inspirationData[currentInspirationIndex] = null;
                        saveAndRenderInspiration();
                    }
                }
            });

            imageUploader.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && currentInspirationIndex !== -1) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        inspirationData[currentInspirationIndex] = { type: 'image', content: event.target.result };
                        saveAndRenderInspiration();
                    };
                    reader.readAsDataURL(file);
                }
                e.target.value = '';
            });

            const saveAndRenderInspiration = () => {
                localStorage.setItem('mindTrackInspirationData', JSON.stringify(inspirationData));
                renderInspirationBoard();
            };

            // --- THEME FUNCTIONALITY ---
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    themeToggle.checked = true;
                } else {
                    document.body.classList.remove('dark-mode');
                    themeToggle.checked = false;
                }
                if (moodChartInstance || healthHabitChartInstance) {
                    renderCharts();
                }
            };

            themeToggle.addEventListener('change', () => {
                const newTheme = themeToggle.checked ? 'dark' : 'light';
                localStorage.setItem('mindTrackTheme', newTheme);
                applyTheme(newTheme);
            });

            // --- QUOTE FUNCTIONALITY ---
            const quotes = [
                { text: "The best way to get started is to quit talking and begin doing.", author: "Walt Disney" },
                { text: "The pessimist sees difficulty in every opportunity. The optimist sees opportunity in every difficulty.", author: "Winston Churchill" },
                { text: "Itâ€™s not whether you get knocked down, itâ€™s whether you get up.", author: "Vince Lombardi" },
                { text: "The only person you are destined to become is the person you decide to be.", author: "Ralph Waldo Emerson" },
                { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
                { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
                { text: "In three words I can sum up everything I've learned about life: it goes on.", author: "Robert Frost" }
            ];

            const showNewQuote = () => {
                const randomIndex = Math.floor(Math.random() * quotes.length);
                quoteTextEl.textContent = `"${quotes[randomIndex].text}"`;
                quoteAuthorEl.textContent = `- ${quotes[randomIndex].author}`;
            };
            newQuoteBtn.addEventListener('click', showNewQuote);

            // --- DATA HANDLING ---
         
            const saveDailyData = () => {
                const dateString = toISODateString(selectedDate);
                const selectedMood = document.querySelector('.mood-option.selected');
                const healthLog = {};
                healthCheckboxes.forEach(cb => { healthLog[cb.id] = cb.checked; });
                
                dailyData[dateString] = {
                    mood: selectedMood ? selectedMood.dataset.mood : null,
                    health: healthLog,
                    notes: notesInput.value,
                };
                
                localStorage.setItem('mindTrackDailyData', JSON.stringify(dailyData));
                alert('Daily Check-in saved!');
                renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
                renderCharts();
            };
            
            const saveJournalData = () => {
                const entryText = journalEntryInput.value.trim();
                if (!entryText) { alert('Journal entry cannot be empty.'); return; }
                const timestamp = new Date().toISOString();
                journalData[timestamp] = entryText;
                localStorage.setItem('mindTrackJournalData', JSON.stringify(journalData));
                journalEntryInput.value = '';
                alert('Journal entry saved!');
                renderJournal();
            };

            const loadDailyDataForDate = (date) => {
                selectedDate = date;
                const dateString = toISODateString(date);
                const data = dailyData[dateString];

                entryDateDisplay.textContent = `Check-in for ${formatDisplayDate(date)}`;
                saveButton.textContent = `Save Check-in for ${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;

                moodOptions.forEach(opt => opt.classList.remove('selected'));
                healthCheckboxes.forEach(cb => cb.checked = false);
                notesInput.value = '';

                if (data) {
                    if (data.mood) document.querySelector(`.mood-option[data-mood="${data.mood}"]`)?.classList.add('selected');
                    if (data.health) {
                        for (const key in data.health) {
                            const cb = document.getElementById(key);
                            if (cb) cb.checked = data.health[key];
                        }
                    }
                    notesInput.value = data.notes || '';
                }
                renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
            };
            
            // --- UI RENDERING ---
            const renderJournal = () => {
                journalLogContainer.innerHTML = '';
                const sortedEntries = Object.keys(journalData).sort().reverse();
                if (sortedEntries.length === 0) {
                    journalLogContainer.innerHTML = '<p>No journal entries yet.</p>';
                    return;
                }
                sortedEntries.forEach(timestamp => {
                    const entryDate = new Date(timestamp);
                    const postDiv = document.createElement('div');
                    postDiv.className = 'journal-post';
                    postDiv.innerHTML = `<p class="journal-post-date">${formatDisplayDate(entryDate)} at ${entryDate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit'})}</p><p class="journal-post-content">${journalData[timestamp]}</p>`;
                    journalLogContainer.appendChild(postDiv);
                });
            };

            const renderCalendar = (year, month) => {
                calendarDaysContainer.innerHTML = '';
                monthYearDisplay.textContent = `${new Date(year, month).toLocaleString('default', { month: 'long' })} ${year}`;
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const todayString = toISODateString(new Date());
                const selectedDateString = toISODateString(selectedDate);
                
                for (let i = 0; i < firstDay; i++) { 
                    calendarDaysContainer.appendChild(document.createElement('div')).className = 'day empty'; 
                }
                
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayDate = new Date(year, month, i);
                    const dayString = toISODateString(dayDate);
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'day';
                    dayDiv.textContent = i;
                    dayDiv.dataset.date = dayString;
                    if (dayString === todayString) dayDiv.classList.add('today');
                    if (dayString === selectedDateString) dayDiv.classList.add('selected-day');

                    const entry = dailyData[dayString];
                    if (entry && entry.mood) {
                        const moodEmoji = moodEmojiMap[entry.mood];
                        if (moodEmoji) {
                            const emojiSpan = document.createElement('span');
                            emojiSpan.className = 'mood-emoji';
                            emojiSpan.textContent = moodEmoji;
                            dayDiv.appendChild(emojiSpan);
                        }
                    }
                    
                    dayDiv.addEventListener('click', () => loadDailyDataForDate(dayDate));
                    calendarDaysContainer.appendChild(dayDiv);
                }
            };
            
            // --- CHART RENDERING ---
            const renderCharts = () => {
                const textColor = getComputedStyle(document.body).getPropertyValue('--text-color');
                const borderColor = getComputedStyle(document.body).getPropertyValue('--border-color');
                const sortedDates = Object.keys(dailyData).sort((a, b) => new Date(a) - new Date(b));

                const chartOptions = {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, ticks: { color: textColor, stepSize: 1 }, grid: { color: borderColor } }, x: { ticks: { color: textColor }, grid: { color: borderColor } } },
                    plugins: { legend: { labels: { color: textColor } } }
                };

                // Mood Chart
                const moodChartLabels = Object.keys(moodChartMap);
                const moodChartData = sortedDates.map(date => dailyData[date].mood ? moodChartMap[dailyData[date].mood] : 0);
                if (moodChartInstance) moodChartInstance.destroy();
                moodChartInstance = new Chart(document.getElementById('moodChart').getContext('2d'), {
                    type: 'line', data: { labels: sortedDates.map(d => new Date(d).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})), datasets: [{ label: 'Mood Trend', data: moodChartData, borderColor: 'rgba(96, 165, 250, 1)', backgroundColor: 'rgba(96, 165, 250, 0.2)', tension: 0.1, fill: true }] },
                    options: { 
                        ...chartOptions, 
                        scales: { 
                            ...chartOptions.scales, 
                            y: { 
                                min: 1, 
                                max: Object.keys(moodChartMap).length, 
                                ticks: { 
                                    color: textColor, 
                                    stepSize: 1, 
                                    callback: (v) => moodChartLabels.find(key => moodChartMap[key] === v) 
                                }, 
                                grid: { color: borderColor } 
                            } 
                        }, 
                        plugins: { 
                            ...chartOptions.plugins, 
                            tooltip: { 
                                callbacks: { 
                                    label: (c) => `Mood: ${moodChartLabels.find(key => moodChartMap[key] === c.parsed.y)}` 
                                } 
                            } 
                        } 
                    }
                });

                // Health Habit Chart
                const healthHabitCounts = {};
                const healthHabitLabels = Array.from(healthCheckboxes).map(cb => cb.parentElement.textContent.trim());
                healthCheckboxes.forEach(cb => { healthHabitCounts[cb.id] = 0; });
                sortedDates.forEach(date => { if (dailyData[date].health) { for (const habit in dailyData[date].health) { if (dailyData[date].health[habit]) healthHabitCounts[habit]++; } } });
                if (healthHabitChartInstance) healthHabitChartInstance.destroy();
                healthHabitChartInstance = new Chart(document.getElementById('healthHabitChart').getContext('2d'), {
                    type: 'bar', data: { labels: healthHabitLabels, datasets: [{ label: 'Total Days Logged', data: Object.values(healthHabitCounts), backgroundColor: ['rgba(239, 68, 68, 0.5)', 'rgba(59, 130, 246, 0.5)', 'rgba(234, 179, 8, 0.5)', 'rgba(16, 185, 129, 0.5)', 'rgba(139, 92, 246, 0.5)', 'rgba(249, 115, 22, 0.5)'] }] },
                    options: { ...chartOptions, plugins: { ...chartOptions.plugins, legend: { display: false } } }
                });
            };

            // --- EVENT LISTENERS ---
            saveButton.addEventListener('click', saveDailyData);
            saveJournalButton.addEventListener('click', saveJournalData);
            moodOptions.forEach(option => option.addEventListener('click', () => {
                moodOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
            }));
            prevMonthButton.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(currentDate.getFullYear(), currentDate.getMonth()); });
            nextMonthButton.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(currentDate.getFullYear(), currentDate.getMonth()); });
            
            // --- INITIALIZATION ---
            const savedTheme = localStorage.getItem('mindTrackTheme') || 'dark';
            applyTheme(savedTheme);
            loadDailyDataForDate(selectedDate);
            renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
            renderCharts();
            renderJournal();
            showNewQuote();
            renderInspirationBoard();
        });

    </script>
</body>
</html>