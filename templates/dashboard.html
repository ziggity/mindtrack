<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MindTrack – Dashboard</title>

    <!-- ✅ Link to your global stylesheet -->
    <!-- If style.css is in the same folder as this file -->
    <link rel="stylesheet" href="style.css" />

    <!-- If you keep style.css inside a "static" folder, use this instead: -->
    <!-- <link rel="stylesheet" href="static/style.css" /> -->
  </head>

  <body>
    <!-- Navbar -->
    <header class="navbar">
      <div class="brand">🧠 MindTrack</div>
      <nav class="nav-links">
        <a href="home.html">🏠 Home</a>
        <a href="dashboard.html" aria-current="page">📊 Dashboard</a>
        <a href="journal.html">📓 Journal</a>
        <a href="check_in.html">🙂 Check-In</a>
        <a href="resources.html">📚 Resources</a>
        <a href="safety.html">🛟 Safety</a>
        <a href="login.html">🔑 Login</a>
        <a href="signup.html">🧾 Sign Up</a>
      </nav>
    </header>

    <!-- Dashboard Section -->
    <section id="dashboard" class="container">
      <div class="card center">
        <h1>📊 Dashboard</h1>

        <div id="stats">
          <p>📓 Total journal entries: <strong id="journalCount">0</strong></p>
          <p>📝 Last journal entry: <span id="lastJournal">None</span></p>
          <p>🙂 Total check-ins: <strong id="checkinCount">0</strong></p>
          <p>🕒 Last check-in: <span id="lastCheckin">None</span></p>
        </div>

        <button id="clearData" class="btn" style="margin-top: 18px">
          🧹 Clear Local Data
        </button>

        <p
          id="clearMsg"
          class="center"
          style="margin-top: 10px; color: var(--accent); display: none"
        >
          Local data cleared ✅
        </p>
      </div>
    </section>

    <!-- Script -->
    <script>
      const journalKey = "journalEntries";
      const checkinKey = "checkIns";

      document.addEventListener("DOMContentLoaded", () => {
        refreshStats();

        // Clear data
        const clearBtn = document.getElementById("clearData");
        clearBtn.addEventListener("click", () => {
          removeData(journalKey);
          removeData(checkinKey);
          refreshStats();
          const msg = document.getElementById("clearMsg");
          msg.style.display = "block";
          setTimeout(() => (msg.style.display = "none"), 1500);
        });

        // Refresh when returning to this page/tab
        document.addEventListener("visibilitychange", () => {
          if (!document.hidden) refreshStats();
        });

        // Refresh when another tab updates localStorage
        window.addEventListener("storage", (e) => {
          if (e.key === journalKey || e.key === checkinKey) refreshStats();
        });
      });

      // --- Core stats logic ---
      function refreshStats() {
        const journals = getData(journalKey) || [];
        const checks = getData(checkinKey) || [];

        setText("journalCount", journals.length);
        setText("checkinCount", checks.length);

        // Last journal entry
        if (journals.length) {
          const last = journals[journals.length - 1];
          setHTML(
            "lastJournal",
            `📝 <strong>${last.date}</strong> — ${truncate(last.text, 120)}`
          );
        } else setText("lastJournal", "None");

        // Last check-in
        if (checks.length) {
          const last = checks[checks.length - 1];
          const detail = `🙂 Mood: ${last.mood}${
            last.notes ? " — " + truncate(last.notes, 120) : ""
          }`;
          setHTML(
            "lastCheckin",
            `🕒 <strong>${last.date}</strong> — ${detail}`
          );
        } else setText("lastCheckin", "None");
      }

      // --- Helper functions ---
      function truncate(s, n) {
        if (!s) return "";
        return s.length > n ? s.slice(0, n) + "..." : s;
      }

      function setText(id, text) {
        const el = document.getElementById(id);
        if (el) el.textContent = text;
      }

      function setHTML(id, html) {
        const el = document.getElementById(id);
        if (el) el.innerHTML = html;
      }

      function getData(key) {
        try {
          return JSON.parse(localStorage.getItem(key) || "[]");
        } catch {
          return [];
        }
      }

      function removeData(key) {
        localStorage.removeItem(key);
      }
    </script>
  </body>
</html>
