<header class="navbar">
  <div class="brand">ğŸ§  MindTrack</div>
  <nav class="nav-links">
    <a href="home.html">ğŸ  Home</a>
    <a href="dashboard.html">ğŸ“Š Dashboard</a>
    <a href="journal.html">ğŸ““ Journal</a>
    <a href="check_in.html">ğŸ™‚ Check-In</a>
    <a href="resources.html">ğŸ“š Resources</a>
    <a href="safety.html">ğŸ›Ÿ Safety</a>
    <a href="login.html">ğŸ”‘ Login</a>
    <a href="signup.html">ğŸ§¾ Sign Up</a>
  </nav>
</header>

<section id="journal">
  <div class="card">
    <h1>Journal</h1>
    <p>Write your thoughts. The date is auto included.</p>

    <form id="journalForm">
      <textarea
        id="entryText"
        rows="6"
        placeholder="Start writing..."
      ></textarea>
      <button type="submit">Save Entry</button>
    </form>

    <h2 style="margin-top: 16px">Entries</h2>
    <div id="entries"></div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("journalForm");
    const textarea = document.getElementById("entryText");
    const entriesDiv = document.getElementById("entries");

    // 1) Load + MIGRATE old entries (add id if missing), then save back
    let list = getEntries();
    let migrated = false;
    list = list.map((e) => {
      if (!e.id) {
        e.id = genId();
        migrated = true;
      }
      return e;
    });
    if (migrated) setEntries(list);

    // 2) Render oldest -> newest (new ones append to bottom)
    list.forEach(renderRow);

    // 3) Save new entry
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = (textarea.value || "").trim();
      if (!text) return;

      const entry = { id: genId(), text, date: new Date().toLocaleString() };
      const current = getEntries();
      current.push(entry);
      setEntries(current);

      renderRow(entry); // append to bottom
      textarea.value = "";
    });

    // 4) Delete handler (event delegation)
    entriesDiv.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-id]");
      if (!btn) return;
      const id = btn.getAttribute("data-id");

      const updated = getEntries().filter((item) => item.id !== id);
      setEntries(updated);

      const row = entriesDiv.querySelector(`.entry-row[data-id="${id}"]`);
      if (row) row.remove();
    });

    // Helpers
    function getEntries() {
      try {
        return JSON.parse(localStorage.getItem("journalEntries") || "[]");
      } catch {
        return [];
      }
    }
    function setEntries(arr) {
      localStorage.setItem("journalEntries", JSON.stringify(arr));
    }
    function genId() {
      return String(Date.now()) + "-" + Math.random().toString(36).slice(2, 8);
    }

    function renderRow(entry) {
      const row = document.createElement("div");
      row.className = "entry-row";
      row.dataset.id = entry.id;
      row.style.padding = "10px 0";
      row.style.borderBottom = "1px solid #ddd";

      const header = document.createElement("div");
      header.style.display = "flex";
      header.style.justifyContent = "space-between";
      header.style.alignItems = "center";

      const dateEl = document.createElement("strong");
      dateEl.textContent = entry.date;

      const delBtn = document.createElement("button");
      delBtn.textContent = "ğŸ—‘ï¸ Delete";
      delBtn.setAttribute("data-id", entry.id);
      delBtn.style.background = "#e11d48";
      delBtn.style.color = "#fff";
      delBtn.style.border = "none";
      delBtn.style.padding = "4px 10px";
      delBtn.style.borderRadius = "4px";
      delBtn.style.cursor = "pointer";

      header.appendChild(dateEl);
      header.appendChild(delBtn);

      const body = document.createElement("p");
      body.style.margin = "8px 0 0";
      body.innerText = entry.text; // plain text (safe)

      row.appendChild(header);
      row.appendChild(body);

      entriesDiv.appendChild(row); // append to bottom
    }
  });
</script>
